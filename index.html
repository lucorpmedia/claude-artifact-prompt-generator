import React, { useState } from 'react';
import { Sparkles, Code2, Edit3, Copy, CheckCircle, AlertCircle, Plus, X, Palette } from 'lucide-react';

export default function ArticlePromptGenerator() {
  const [fields, setFields] = useState({
    seoTitle: '',
    mainKeyword: '',
    ctaPlaceholder: 'Get Started Now',
    affiliateLink: '',
    seoDescription: '',
    pageTitle: '',
    productName: '',
    ctaText: 'Click Here',
    yourUrl: '',
    moneySiteUrl: '',
    anchorText: '',
    additionalLink: '',
    additionalAnchor: ''
  });

  const [additionalUrls, setAdditionalUrls] = useState([]);
  const [colors, setColors] = useState({
    main: 'blue',
    accent: 'orange',
    cta: 'red'
  });

  const [perplexityInput, setPerplexityInput] = useState('');
  const [copied, setCopied] = useState(false);
  const [showPrompt, setShowPrompt] = useState(false);
  const [parseStatus, setParseStatus] = useState('');
  const [generatedPrompt, setGeneratedPrompt] = useState('');

  // Inline styles
  const styles = {
    container: {
      minHeight: '100vh',
      backgroundColor: '#000',
      color: '#00D9FF',
      padding: '16px',
      backgroundImage: `
        radial-gradient(circle at 20% 50%, rgba(120, 0, 255, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(255, 0, 120, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(0, 255, 120, 0.2) 0%, transparent 50%)
      `,
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'
    },
    maxWidth: {
      maxWidth: '1280px',
      margin: '0 auto'
    },
    title: {
      fontSize: 'clamp(2.5rem, 6vw, 4rem)',
      fontWeight: 'bold',
      marginBottom: '8px',
      background: 'linear-gradient(to right, #00D9FF, #A855F7, #EC4899)',
      WebkitBackgroundClip: 'text',
      WebkitTextFillColor: 'transparent',
      backgroundClip: 'text',
      textAlign: 'center'
    },
    subtitle: {
      color: '#C084FC',
      fontSize: '1.125rem',
      textAlign: 'center'
    },
    section: {
      marginBottom: '32px',
      background: 'rgba(17, 24, 39, 0.8)',
      backdropFilter: 'blur(12px)',
      borderRadius: '8px',
      padding: '24px',
      border: '1px solid #A855F7',
      boxShadow: '0 10px 30px rgba(168, 85, 247, 0.2)'
    },
    sectionCyan: {
      marginBottom: '32px',
      background: 'rgba(17, 24, 39, 0.8)',
      backdropFilter: 'blur(12px)',
      borderRadius: '8px',
      padding: '24px',
      border: '1px solid #00D9FF',
      boxShadow: '0 10px 30px rgba(0, 217, 255, 0.2)'
    },
    sectionTitle: {
      fontSize: '1.5rem',
      fontWeight: 'bold',
      marginBottom: '16px',
      display: 'flex',
      alignItems: 'center',
      gap: '8px'
    },
    textarea: {
      width: '100%',
      height: '160px',
      background: 'rgba(0, 0, 0, 0.5)',
      border: '1px solid #00D9FF',
      borderRadius: '4px',
      padding: '12px',
      color: '#00D9FF',
      fontSize: '14px',
      fontFamily: 'monospace',
      resize: 'vertical',
      outline: 'none'
    },
    input: {
      width: '100%',
      background: 'rgba(0, 0, 0, 0.5)',
      border: '1px solid #4B5563',
      borderRadius: '4px',
      padding: '8px 12px',
      color: '#00D9FF',
      outline: 'none'
    },
    button: {
      padding: '8px 24px',
      background: 'linear-gradient(to right, #9333EA, #EC4899)',
      color: 'white',
      fontWeight: 'bold',
      borderRadius: '4px',
      border: 'none',
      cursor: 'pointer',
      transition: 'all 0.3s',
      boxShadow: '0 10px 20px rgba(147, 51, 234, 0.3)'
    },
    generateButton: {
      padding: '12px 32px',
      background: 'linear-gradient(to right, #0891B2, #9333EA)',
      color: 'white',
      fontWeight: 'bold',
      fontSize: '1.125rem',
      borderRadius: '8px',
      border: 'none',
      cursor: 'pointer',
      transition: 'all 0.3s',
      boxShadow: '0 20px 40px rgba(8, 145, 178, 0.3)',
      transform: 'scale(1)',
      display: 'inline-block'
    },
    copyButton: {
      padding: '8px 16px',
      background: 'linear-gradient(to right, #059669, #0891B2)',
      color: 'white',
      fontWeight: 'bold',
      borderRadius: '4px',
      border: 'none',
      cursor: 'pointer',
      display: 'flex',
      alignItems: 'center',
      gap: '8px'
    },
    grid: {
      display: 'grid',
      gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))',
      gap: '24px',
      marginBottom: '32px'
    },
    gridItem: {
      background: 'rgba(17, 24, 39, 0.6)',
      backdropFilter: 'blur(8px)',
      borderRadius: '8px',
      padding: '16px',
      border: '1px solid #00D9FF',
      transition: 'border-color 0.3s'
    },
    label: {
      display: 'block',
      fontSize: '14px',
      fontWeight: '600',
      marginBottom: '8px',
      color: '#C084FC',
      display: 'flex',
      alignItems: 'center',
      gap: '8px'
    },
    codeBlock: {
      background: 'rgba(0, 0, 0, 0.5)',
      borderRadius: '4px',
      padding: '16px',
      color: '#00D9FF',
      fontSize: '14px',
      overflowX: 'auto',
      whiteSpace: 'pre-wrap',
      border: '1px solid #374151',
      fontFamily: 'monospace'
    },
    colorGrid: {
      display: 'grid',
      gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
      gap: '16px'
    },
    additionalUrlRow: {
      display: 'flex',
      gap: '16px',
      marginBottom: '12px',
      alignItems: 'center'
    },
    removeButton: {
      padding: '8px 12px',
      background: '#DC2626',
      color: 'white',
      borderRadius: '4px',
      border: 'none',
      cursor: 'pointer'
    }
  };

  const handleFieldChange = (field, value) => {
    setFields(prev => ({ ...prev, [field]: value }));
  };

  const handleColorChange = (colorType, value) => {
    setColors(prev => ({ ...prev, [colorType]: value }));
  };

  const addAdditionalUrl = () => {
    setAdditionalUrls([...additionalUrls, { url: '', anchor: '' }]);
  };

  const removeAdditionalUrl = (index) => {
    setAdditionalUrls(additionalUrls.filter((_, i) => i !== index));
  };

  const updateAdditionalUrl = (index, field, value) => {
    const updated = [...additionalUrls];
    updated[index][field] = value;
    setAdditionalUrls(updated);
  };

  const parsePerplexityData = () => {
    setParseStatus('Parsing data...');
    const text = perplexityInput;
    const updatedFields = { ...fields };
    const updatedColors = { ...colors };
    let foundData = false;

    // Extract SEO Title
    const seoTitleMatch = text.match(/(?:SEO Title|1\.\s*SEO Title)[:\s]*\n?([^\n]+)/i);
    if (seoTitleMatch) {
      updatedFields.seoTitle = seoTitleMatch[1].trim();
      foundData = true;
    }

    // Extract SEO Description
    const seoDescMatch = text.match(/(?:SEO Meta Description|2\.\s*SEO Meta Description)[:\s]*\n?([^\n]+(?:\n[^\n]+)?)/i);
    if (seoDescMatch) {
      updatedFields.seoDescription = seoDescMatch[1].trim().replace(/\n/g, ' ');
      foundData = true;
    }

    // Extract H1 (Page Title)
    const h1Match = text.match(/(?:H1:|3\.\s*H1:)\s*([^\n]+)/i);
    if (h1Match) {
      updatedFields.pageTitle = h1Match[1].trim();
      foundData = true;
    }

    // Extract product/company name from title or H1
    let productName = '';
    if (updatedFields.seoTitle) {
      const productFromTitle = updatedFields.seoTitle.match(/^([^:,\-]+)/);
      if (productFromTitle) {
        productName = productFromTitle[1].trim();
      }
    } else if (updatedFields.pageTitle) {
      const productFromH1 = updatedFields.pageTitle.match(/^([^:,\-]+)/);
      if (productFromH1) {
        productName = productFromH1[1].trim();
      }
    }
    
    // Look for company/product name in the text
    const companyMatch = text.match(/(?:What is|Overview of|About)\s+([A-Z][^?\n.]+)/);
    if (companyMatch) {
      productName = companyMatch[1].trim();
    }

    if (productName) {
      updatedFields.productName = productName;
      foundData = true;
    }

    // Extract main keyword
    const keywordMatch = text.match(/(?:Key phrases?:|target keyword:|main keyword:)\s*([^,\n]+)/i);
    if (keywordMatch) {
      updatedFields.mainKeyword = keywordMatch[1].trim();
      foundData = true;
    } else if (productName) {
      updatedFields.mainKeyword = productName.toLowerCase();
      foundData = true;
    }

    // Extract URLs
    const urlMatches = text.match(/https?:\/\/[^\s\)]+/g);
    if (urlMatches && urlMatches.length > 0) {
      updatedFields.affiliateLink = urlMatches[0];
      updatedFields.yourUrl = urlMatches[0];
      updatedFields.moneySiteUrl = urlMatches[1] || urlMatches[0];
      if (urlMatches[2]) {
        updatedFields.additionalLink = urlMatches[2];
      }
      foundData = true;
    }

    // Set anchor text based on product name
    if (productName && !updatedFields.anchorText) {
      updatedFields.anchorText = productName;
      updatedFields.additionalAnchor = `${productName} Review`;
    }

    // Extract colors if present
    const mainColorMatch = text.match(/(?:main color|primary color)[:\s]*([^\n,]+)/i);
    if (mainColorMatch) {
      updatedColors.main = mainColorMatch[1].trim().toLowerCase();
    }

    const accentColorMatch = text.match(/(?:accent color|secondary color)[:\s]*([^\n,]+)/i);
    if (accentColorMatch) {
      updatedColors.accent = accentColorMatch[1].trim().toLowerCase();
    }

    const ctaColorMatch = text.match(/(?:cta color|button color|call.to.action color)[:\s]*([^\n,]+)/i);
    if (ctaColorMatch) {
      updatedColors.cta = ctaColorMatch[1].trim().toLowerCase();
    }

    // Update CTA text based on context
    if (text.toLowerCase().includes('review')) {
      updatedFields.ctaText = 'Read Full Review';
      updatedFields.ctaPlaceholder = 'Get Started Today';
    }

    setFields(updatedFields);
    setColors(updatedColors);
    
    if (foundData) {
      setParseStatus('✓ Data parsed successfully!');
    } else {
      setParseStatus('⚠ No structured data found. Check your input format.');
    }

    setTimeout(() => setParseStatus(''), 3000);
  };

  const handleGeneratePrompt = () => {
    let additionalLinksText = '';
    if (additionalUrls.length > 0) {
      additionalLinksText = additionalUrls.map(item => 
        `\nAlso link to this resource: ${item.url || '(ADDITIONAL URL)'} Using the anchor text ${item.anchor || '(ANCHOR TEXT)'}`
      ).join('');
    }

    const prompt = `I want to use this article to build an optimized page for ${fields.seoTitle || '(SEO TITLE - KEYWORD)'}
On the header section start with the term ${fields.mainKeyword || '(MAIN KEYWORD)'} at the top left and on the right have a call to action button that says "${fields.ctaPlaceholder}" that links to ${fields.affiliateLink || '(AFFILIATE LINK)'}
 
Meta details:
SEO Title: ${fields.seoTitle || '(SEO TITLE)'}
SEO Description- ${fields.seoDescription || '(SEO Description)'}

H1 should be the centered with the following: ${fields.pageTitle || '(TITLE OF YOUR PAGE)'}

Then a sentence below it that says

Looking for the best offer for ${fields.productName || '(PRODUCT NAME)'}?
Then have a call to action button below that says ("${fields.ctaText}") that links to ${fields.yourUrl || '(YOURURL)'} 

Inside the article - use this url ${fields.moneySiteUrl || '(YOUR MONEY SITE URL)'} with the Anchor ${fields.anchorText || '(YOUR DESIRED ANCHOR TEXT)'} in an area that makes sense

Also link to this resource:${fields.additionalLink || '(LINK TO ADDITIONAL CLAUDE CODE PAGE OR HOME PAGE OF MONEY SITE)'} Using the anchor text ${fields.additionalAnchor || '(DESIRED ANCHOR)'}${additionalLinksText}

Use graphs and charts to highlight the offer and benefits to break up the text for better readability.

End the article with another call to action like the one before but without using the H1 - instead use an H2 tag.

Use schema for FAQ and product details

Create this as an artifact that can be published.

The artifact and artifact id should be labeled clearly as ${fields.seoTitle || '(YOUR SEO TITLE)'}

And user interface buttons that you label in the code - use the name ${fields.seoTitle || '(YOUR SEO TITLE)'} as they're name. 

All for organization purposes. 

Use lighter colors like white and gray. The Main Color should be ${colors.main}, with an accent color ${colors.accent}. The CTA should be ${colors.cta}`;

    setGeneratedPrompt(prompt);
    setShowPrompt(true);
  };

  const copyToClipboard = () => {
    navigator.clipboard.writeText(generatedPrompt);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  return (
    <div style={styles.container}>
      <div style={styles.maxWidth}>
        {/* Header */}
        <div style={{ marginBottom: '32px', textAlign: 'center' }}>
          <h1 style={styles.title}>
            ARTICLE GENERATOR v1.0
          </h1>
          <p style={styles.subtitle}>Review Artifact Prompt Builder</p>
          <div style={{ display: 'flex', justifyContent: 'center', gap: '8px', marginTop: '16px' }}>
            <Sparkles size={20} color="#EC4899" style={{ animation: 'pulse 2s infinite' }} />
            <Code2 size={20} color="#00D9FF" style={{ animation: 'pulse 2s infinite' }} />
            <Sparkles size={20} color="#A855F7" style={{ animation: 'pulse 2s infinite' }} />
          </div>
        </div>

        {/* Perplexity Input Section */}
        <div style={styles.section}>
          <h2 style={styles.sectionTitle}>
            <AlertCircle size={24} color="#EC4899" />
            Import Perplexity Data
          </h2>
          <div style={{ marginBottom: '12px', fontSize: '14px', color: '#9CA3AF' }}>
            <p>Paste your structured data below. The parser will extract:</p>
            <ul style={{ listStyle: 'disc', listStylePosition: 'inside', marginTop: '4px', color: '#00D9FF' }}>
              <li>SEO Title, Meta Description, H1</li>
              <li>Product/Company names, Keywords</li>
              <li>URLs and color preferences</li>
            </ul>
          </div>
          <textarea
            value={perplexityInput}
            onChange={(e) => setPerplexityInput(e.target.value)}
            placeholder="Paste your Perplexity research data here..."
            style={styles.textarea}
          />
          <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginTop: '12px' }}>
            <button
              onClick={parsePerplexityData}
              style={styles.button}
              onMouseEnter={(e) => e.target.style.transform = 'scale(1.05)'}
              onMouseLeave={(e) => e.target.style.transform = 'scale(1)'}
            >
              Parse Data
            </button>
            {parseStatus && (
              <span style={{ 
                fontSize: '14px', 
                color: parseStatus.includes('✓') ? '#10B981' : '#FBBF24' 
              }}>
                {parseStatus}
              </span>
            )}
          </div>
        </div>

        {/* Color Customization */}
        <div style={styles.sectionCyan}>
          <h2 style={styles.sectionTitle}>
            <Palette size={24} color="#EC4899" />
            Color Scheme
          </h2>
          <div style={styles.colorGrid}>
            <div>
              <label style={styles.label}>Main Color</label>
              <input
                type="text"
                value={colors.main}
                onChange={(e) => handleColorChange('main', e.target.value)}
                style={styles.input}
                placeholder="e.g., blue"
              />
            </div>
            <div>
              <label style={styles.label}>Accent Color</label>
              <input
                type="text"
                value={colors.accent}
                onChange={(e) => handleColorChange('accent', e.target.value)}
                style={styles.input}
                placeholder="e.g., orange"
              />
            </div>
            <div>
              <label style={styles.label}>CTA Color</label>
              <input
                type="text"
                value={colors.cta}
                onChange={(e) => handleColorChange('cta', e.target.value)}
                style={styles.input}
                placeholder="e.g., red"
              />
            </div>
          </div>
        </div>

        {/* Fields Grid */}
        <div style={styles.grid}>
          {Object.entries({
            'SEO Title': 'seoTitle',
            'Main Keyword': 'mainKeyword',
            'CTA Button Text': 'ctaPlaceholder',
            'Affiliate Link': 'affiliateLink',
            'SEO Description': 'seoDescription',
            'Page Title (H1)': 'pageTitle',
            'Product Name': 'productName',
            'CTA Link Text': 'ctaText',
            'Your URL': 'yourUrl',
            'Money Site URL': 'moneySiteUrl',
            'Anchor Text': 'anchorText',
            'Additional Link': 'additionalLink',
            'Additional Anchor': 'additionalAnchor'
          }).map(([label, field]) => (
            <div 
              key={field} 
              style={styles.gridItem}
              onMouseEnter={(e) => e.currentTarget.style.borderColor = '#EC4899'}
              onMouseLeave={(e) => e.currentTarget.style.borderColor = '#00D9FF'}
            >
              <label style={styles.label}>
                <Edit3 size={16} />
                {label}
              </label>
              <input
                type="text"
                value={fields[field]}
                onChange={(e) => handleFieldChange(field, e.target.value)}
                style={styles.input}
                placeholder={`Enter ${label.toLowerCase()}...`}
                onFocus={(e) => e.target.style.borderColor = '#00D9FF'}
                onBlur={(e) => e.target.style.borderColor = '#4B5563'}
              />
            </div>
          ))}
        </div>

        {/* Additional URLs Section */}
        <div style={styles.section}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
            <h2 style={{ ...styles.sectionTitle, marginBottom: 0 }}>
              <Plus size={20} color="#EC4899" />
              Additional URLs & Anchors
            </h2>
            <button
              onClick={addAdditionalUrl}
              style={{ ...styles.button, background: 'linear-gradient(to right, #059669, #0891B2)' }}
              onMouseEnter={(e) => e.target.style.transform = 'scale(1.05)'}
              onMouseLeave={(e) => e.target.style.transform = 'scale(1)'}
            >
              <Plus size={16} style={{ display: 'inline', marginRight: '4px' }} />
              Add URL
            </button>
          </div>
          
          {additionalUrls.map((item, index) => (
            <div key={index} style={styles.additionalUrlRow}>
              <input
                type="text"
                value={item.url}
                onChange={(e) => updateAdditionalUrl(index, 'url', e.target.value)}
                style={{ ...styles.input, flex: 1 }}
                placeholder="URL"
              />
              <input
                type="text"
                value={item.anchor}
                onChange={(e) => updateAdditionalUrl(index, 'anchor', e.target.value)}
                style={{ ...styles.input, flex: 1 }}
                placeholder="Anchor Text"
              />
              <button
                onClick={() => removeAdditionalUrl(index)}
                style={styles.removeButton}
              >
                <X size={16} />
              </button>
            </div>
          ))}
        </div>

        {/* Generate Button */}
        <div style={{ textAlign: 'center', marginBottom: '32px' }}>
          <button
            onClick={handleGeneratePrompt}
            style={styles.generateButton}
            onMouseEnter={(e) => {
              e.target.style.transform = 'scale(1.05)';
              e.target.style.boxShadow = '0 25px 50px rgba(8, 145, 178, 0.4)';
            }}
            onMouseLeave={(e) => {
              e.target.style.transform = 'scale(1)';
              e.target.style.boxShadow = '0 20px 40px rgba(8, 145, 178, 0.3)';
            }}
          >
            GENERATE PROMPT
          </button>
        </div>

        {/* Generated Prompt Display */}
        {showPrompt && (
          <div style={{ ...styles.section, borderColor: '#EC4899', boxShadow: '0 10px 30px rgba(236, 72, 153, 0.2)' }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
              <h3 style={{ ...styles.sectionTitle, color: '#EC4899', marginBottom: 0 }}>Generated Prompt</h3>
              <button
                onClick={copyToClipboard}
                style={styles.copyButton}
              >
                {copied ? (
                  <>
                    <CheckCircle size={20} />
                    Copied!
                  </>
                ) : (
                  <>
                    <Copy size={20} />
                    Copy to Clipboard
                  </>
                )}
              </button>
            </div>
            <pre style={styles.codeBlock}>
              {generatedPrompt}
            </pre>
          </div>
        )}

        {/* Footer */}
        <div style={{ marginTop: '48px', textAlign: 'center', color: '#6B7280', fontSize: '14px' }}>
          <p>Claude Artifact SEO Generator v1.0 | Review Artifact Builder</p>
        </div>
      </div>

      <style>{`
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
      `}</style>
    </div>
  );
}
